---
import Layout from '../layouts/Layout.astro';
---

<Layout title="å­¦æ ¡ç¥­äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ">
	<main>
		<div class="container">
			<header>
				<h1>ğŸª å­¦æ ¡ç¥­ é£Ÿäº‹äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </h1>
				<p>ãŠé£Ÿäº‹ã®äºˆç´„ã‚’ãŠå–ã‚Šã„ãŸã—ã¾ã™ã€‚ä¸‹è¨˜ãƒ•ã‚©ãƒ¼ãƒ ã«ã”è¨˜å…¥ãã ã•ã„ã€‚</p>
			</header>

			<form id="reservationForm" class="reservation-form">
				<div class="form-group">
					<label for="name">ãŠåå‰ *</label>
					<input type="text" id="name" name="name" required>
				</div>

				<div class="form-group">
					<label for="phone">é›»è©±ç•ªå· *</label>
					<input type="tel" id="phone" name="phone" required>
				</div>

				<div class="form-group">
					<label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
					<input type="email" id="email" name="email">
				</div>

				<div class="form-group">
					<label for="people">äººæ•° *</label>
					<select id="people" name="people" required>
						<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
						<option value="1">1å</option>
						<option value="2">2å</option>
						<option value="3">3å</option>
						<option value="4">4å</option>
						<option value="5">5åä»¥ä¸Š</option>
					</select>
				</div>

				<div class="form-group">
					<label for="menu">å¸Œæœ›ãƒ¡ãƒ‹ãƒ¥ãƒ¼ *</label>
					<select id="menu" name="menu" required>
						<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
						<option value="yakisoba">ç„¼ããã° (Â¥500)</option>
						<option value="takoyaki">ãŸã“ç„¼ã (Â¥400)</option>
						<option value="karaage">ã‹ã‚‰ã‚ã’ (Â¥600)</option>
						<option value="yakitori">ç„¼ãé³¥ (Â¥300)</option>
						<option value="drink">é£²ã¿ç‰©ã‚»ãƒƒãƒˆ (Â¥200)</option>
					</select>
				</div>

				<div class="form-group">
					<label for="time">å¸Œæœ›æ™‚é–“å¸¯ *</label>
					<select id="time" name="time" required>
						<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
						<option value="10:00-11:00">10:00-11:00</option>
						<option value="11:00-12:00">11:00-12:00</option>
						<option value="12:00-13:00">12:00-13:00</option>
						<option value="13:00-14:00">13:00-14:00</option>
						<option value="14:00-15:00">14:00-15:00</option>
						<option value="15:00-16:00">15:00-16:00</option>
					</select>
				</div>

				<div class="form-group">
					<label for="notes">å‚™è€ƒ</label>
					<textarea id="notes" name="notes" rows="3" placeholder="ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã‚„ç‰¹åˆ¥ãªã”è¦æœ›ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã”è¨˜å…¥ãã ã•ã„"></textarea>
				</div>

				<button type="submit" class="submit-btn">äºˆç´„ã™ã‚‹</button>
			</form>

			<div id="result" class="result hidden"></div>
		</div>
	</main>

	<script>
		document.getElementById('reservationForm')?.addEventListener('submit', async (e) => {
			e.preventDefault();
			
			const formData = new FormData(e.target as HTMLFormElement);
			const data = Object.fromEntries(formData.entries());
			
			const submitBtn = document.querySelector('.submit-btn') as HTMLButtonElement;
			const resultDiv = document.getElementById('result');
			
			if (!resultDiv) return;
			
			submitBtn.disabled = true;
			submitBtn.textContent = 'äºˆç´„ä¸­...';
			
			try {
				const response = await fetch('/api/reserve', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(data),
				});
				
				const result = await response.json();
				
				if (response.ok) {
					resultDiv.className = 'result success';
					resultDiv.innerHTML = `
						<h3>âœ… äºˆç´„å®Œäº†ï¼</h3>
						<p><strong>äºˆç´„ç•ªå·:</strong> ${result.reservationId}</p>
						<p>äºˆç´„ç•ªå·ã¯å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚</p>
						<p>å½“æ—¥ã€ã“ã®ç•ªå·ã‚’ãŠæŒã¡ãã ã•ã„ã€‚</p>
						<button onclick="location.reload()" class="new-reservation-btn">æ–°ã—ã„äºˆç´„ã‚’ã™ã‚‹</button>
					`;
					(e.target as HTMLFormElement).reset();
				} else {
					throw new Error(result.error || 'äºˆç´„ã«å¤±æ•—ã—ã¾ã—ãŸ');
				}
			} catch (error) {
				resultDiv.className = 'result error';
				resultDiv.innerHTML = `
					<h3>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
					<p>${error instanceof Error ? error.message : 'äºˆç´„å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'}</p>
					<button onclick="location.reload()" class="retry-btn">å†è©¦è¡Œ</button>
				`;
			} finally {
				submitBtn.disabled = false;
				submitBtn.textContent = 'äºˆç´„ã™ã‚‹';
				resultDiv.classList.remove('hidden');
				resultDiv.scrollIntoView({ behavior: 'smooth' });
			}
		});
	</script>

	<style>
		.container {
			max-width: 600px;
			margin: 0 auto;
			padding: 2rem;
		}

		header {
			text-align: center;
			margin-bottom: 2rem;
		}

		header h1 {
			color: #d97706;
			font-size: 2.5rem;
			margin-bottom: 0.5rem;
		}

		header p {
			color: #6b7280;
			font-size: 1.1rem;
		}

		.reservation-form {
			background: white;
			padding: 2rem;
			border-radius: 12px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		}

		.form-group {
			margin-bottom: 1.5rem;
		}

		label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 600;
			color: #374151;
		}

		input, select, textarea {
			width: 100%;
			padding: 0.75rem;
			border: 2px solid #e5e7eb;
			border-radius: 8px;
			font-size: 1rem;
			transition: border-color 0.2s;
		}

		input:focus, select:focus, textarea:focus {
			outline: none;
			border-color: #d97706;
		}

		.submit-btn {
			width: 100%;
			background: #d97706;
			color: white;
			border: none;
			padding: 1rem;
			border-radius: 8px;
			font-size: 1.1rem;
			font-weight: 600;
			cursor: pointer;
			transition: background-color 0.2s;
		}

		.submit-btn:hover:not(:disabled) {
			background: #b45309;
		}

		.submit-btn:disabled {
			background: #9ca3af;
			cursor: not-allowed;
		}

		.result {
			margin-top: 2rem;
			padding: 1.5rem;
			border-radius: 8px;
			text-align: center;
		}

		.result.success {
			background: #f0f9ff;
			border: 2px solid #0ea5e9;
			color: #0c4a6e;
		}

		.result.error {
			background: #fef2f2;
			border: 2px solid #ef4444;
			color: #991b1b;
		}

		.result.hidden {
			display: none;
		}

		.new-reservation-btn, .retry-btn {
			margin-top: 1rem;
			padding: 0.5rem 1rem;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-weight: 500;
		}

		.new-reservation-btn {
			background: #10b981;
			color: white;
		}

		.retry-btn {
			background: #ef4444;
			color: white;
		}

		body {
			background: linear-gradient(135deg, #fef3c7, #fed7aa);
			min-height: 100vh;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}
	</style>
</Layout>
